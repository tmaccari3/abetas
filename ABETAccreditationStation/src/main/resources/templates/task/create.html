<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<link href="/task.css" rel="stylesheet" />
<meta charset="ISO-8859-1">
<title>Create Task</title>
</head>
<body layout:fragment="content">
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<form action="#" id="task" th:action="@{/task/create}"
		th:object="${task}" method="post">
		<div class="task-container">
			<h3 style="text-align: center">Create a Task</h3>
			<br>
			<div class="title-container">
				<div class="inline center">
					<label>Title:</label> <input type="text" th:field="*{title}" />
				</div>
				<div class="inline center">
					<p class="error" th:if="${#fields.hasErrors('title')}"
						th:errors="*{title}">Title Error</p>
				</div>
			</div>
			<br>
			<h5>Assignee List</h5>
			<label class="error" th:if="${#fields.hasErrors('assignees')}"
				th:errors="*{assignees}">Assignees Error</label>
			<table>
				<thead>
					<tr>
						<th>Email</th>
						<th></th>
						<th class="create">
							<button class="abetas-button" type="submit" name="addRow"
								formnovalidate="formnovalidate">
								<span class="fa fa-plus"></span> Add Assignee
							</button>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="assignee,rowIter : *{assignees}">
						<td th:text="${rowIter.index + 1}" /></td>
						<td><input type="email"
							th:field="*{assignees[__${rowIter.index}__]}" /></td>
						<td class="create">
							<button class="abetas-button" type="submit" name="removeRow"
								th:value="${rowIter.index}" formnovalidate="formnovalidate">
								<span class="fa fa-minus"></span> Remove
							</button>
						</td>
					</tr>
				</tbody>
			</table>
			<br>
			<div class="inline">
				<div>
					<h5>Program(s)</h5>
					<label class="error" th:if="${#fields.hasErrors('programs')}"
						th:errors="*{programs}">Program Error</label>
					<ul>
						<li th:each="aProg,rowIter : ${progTypes}"><input type="checkbox"
							th:field="*{programs}" th:value="${aProg.name}" name="addProgram" 
							onClick="disableChange(this)"/>
							<!-- th:attr="onChange=|addProgram(${aProg.id}, this.id)|"
							formnovalidate="formnovalidate"/>--> 
							<label th:for="${#ids.prev('programs')}" th:text="${aProg.name}">Default
								Program</label>
								
							<label class="error" th:if="${#fields.hasErrors('outcomes')}"
								th:errors="*{outcomes}">Outcome Error</label>
							<ul>
								<li th:name="${'programs' + (rowIter.index + 1)}" th:each="outcome : ${aProg.outcomes}">
									<input type="checkbox" th:field="*{outcomes}"
										th:value="${outcome.name}" disabled/> 
									<label th:for="${#ids.prev('outcomes')}" 
										th:text="${outcome.name}">Default
										Outcome</label></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
			<br>
			<div class="area-container">
				<h6>Task Description:</h6>
				<p class="error" th:if="${#fields.hasErrors('description')}"
					th:errors="*{description}">Description Error</p>
				<textarea placeholder="Enter description..."
					th:field="*{description}" rows="4" cols="50" maxlength="255">
           					Enter Program Outcome...</textarea>
			</div>
			<br>
			<div style="float: right" class="inline">
				<button class="abetas-button" type="submit" name="cancel"
					formnovalidate="formnovalidate" value="cancel">Return</button>
			</div>
			<div class="inline">
				<button class="abetas-button" type="submit" name="btnSubmit"
					value="Submit">Submit</button>
			</div>
		</div>
	</form>
	<script>
		$(document).ready(function() {
			var programs = document.getElementsByName("programs");
			var outcomes = document.getElementsByName("outcomes");	
			
			for(var i = 0; i < programs.length; i++) {
				disableChange(programs[i]);
			}
		});
	
		function addProgram(id, inputId) {
			var progInput = document.createElement("input");
			progInput.type = "hidden";

			var checkbox = document.getElementById(inputId);
			if (checkbox.checked) {
				progInput.name = "addProgram"
			} else {
				progInput.name = "removeProgram"
			}
			progInput.value = id;

			var form = document.getElementById("task");
			form.appendChild(progInput);
			form.submit();
		}
		
		function disableChange(input) {
			var clicked = document.getElementById(input.id);
			var outcomes = document.getElementsByName("outcomes");	
			
			
			if(clicked.checked) {
				for(var i = 0; i < outcomes.length; i++) {
					if(outcomes[i].parentNode.getAttribute("name") == clicked.id) {
						outcomes[i].disabled = false;
					}
				}
			}
			
			else {
				for(var i = 0; i < outcomes.length; i++) {
					if(outcomes[i].parentNode.getAttribute("name") == clicked.id) {
						outcomes[i].disabled = true;
						outcomes[i].checked = false;
					}
				}
			}
		}
	</script>
</body>
</html>